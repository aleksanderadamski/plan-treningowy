<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Treningowy Pro</title>
    <!-- Biblioteki zewnƒôtrzne: Tailwind CSS do stylizacji, Chart.js do wykres√≥w -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
          darkMode: 'class',
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Definicja kolor√≥w gradientu dla trybu jasnego i ciemnego */
        :root {
          --grad-color-1: #e0f2fe; --grad-color-2: #f0f9ff;
          --grad-color-3: #fefce8; --grad-color-4: #ecfdf5;
        }
        html.dark {
          --grad-color-1: #1e3a8a; --grad-color-2: #1e1b4b;
          --grad-color-3: #4a044e; --grad-color-4: #312e81;
        }
        /* Stylizacja t≈Ça z animowanym gradientem */
        body {
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background: linear-gradient(-45deg, var(--grad-color-1), var(--grad-color-2), var(--grad-color-3), var(--grad-color-4));
            background-size: 400% 400%;
            animation: gradientFloat 25s ease infinite;
            background-position-y: calc(50% + var(--scroll-y, 0px));
            transition: background 0.5s ease;
            overflow-x: hidden;
            min-height: 100vh;
        }
        @keyframes gradientFloat {
            0% { background-position-x: 0%; }
            50% { background-position-x: 100%; }
            100% { background-position-x: 0%; }
        }
        .nav-btn.active { color: #2563eb; }
        html.dark .nav-btn.active { color: #60a5fa; }
        .page-pane { transition: transform 0.3s ease-out, opacity 0.3s ease-out; }
        
        /* Animacje przej≈õƒá miƒôdzy zak≈Çadkami (swipe) */
        @keyframes slide-in-from-right { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slide-out-to-left { from { transform: translateX(0); opacity: 1; } to { transform: translateX(-100%); opacity: 0; } }
        @keyframes slide-in-from-left { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slide-out-to-right { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        .animate-slide-in-from-right { animation: slide-in-from-right 0.3s forwards; }
        .animate-slide-out-to-left { animation: slide-out-to-left 0.3s forwards; }
        .animate-slide-in-from-left { animation: slide-in-from-left 0.3s forwards; }
        .animate-slide-out-to-right { animation: slide-out-to-right 0.3s forwards; }

        /* Stylizacja elementu details - akordeon zasad */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details summary:after { content: '+'; float: right; font-weight: bold; transition: transform 0.2s; }
        details[open] summary:after { transform: rotate(45deg); }
        
        #auth-overlay { backdrop-filter: blur(10px); }
    </style>
</head>
<body class="text-gray-800 dark:text-gray-300">

    <!-- Ekran logowania/rejestracji - widoczny przed autoryzacjƒÖ -->
    <div id="auth-overlay" class="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-white/70 dark:bg-gray-900/70">
        <div class="w-full max-w-sm bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-2xl border border-gray-100 dark:border-gray-700 text-center">
            <h2 class="text-2xl font-bold mb-6">Witaj</h2>
            <div class="space-y-4">
                <button id="google-login" class="w-full flex items-center justify-center gap-3 p-3 border rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition font-semibold">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" width="20"> Google SSO
                </button>
                <div class="relative flex items-center py-2">
                    <div class="flex-grow border-t"></div><span class="px-3 text-xs text-gray-400">lub email</span><div class="flex-grow border-t"></div>
                </div>
                <input type="email" id="auth-email" placeholder="Email" class="w-full p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border-none outline-none focus:ring-2 focus:ring-blue-500">
                <input type="password" id="auth-password" placeholder="Has≈Ço" class="w-full p-3 rounded-xl bg-gray-50 dark:bg-gray-900 border-none outline-none focus:ring-2 focus:ring-blue-500">
                <div class="flex gap-2">
                    <button id="email-login" class="flex-1 bg-blue-600 text-white p-3 rounded-xl font-bold hover:bg-blue-700">Logowanie</button>
                    <button id="email-register" class="flex-1 border border-blue-600 text-blue-600 p-3 rounded-xl font-bold">Rejestracja</button>
                </div>
            </div>
            <p id="auth-error" class="mt-4 text-xs text-red-500 font-medium"></p>
        </div>
    </div>

    <!-- G≈Ç√≥wna zawarto≈õƒá aplikacji - ukryta do momentu zalogowania -->
    <div id="app-content" class="hidden pb-24">
        <header class="text-center p-6 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm border-b border-gray-200/50 dark:border-gray-700/50 relative">
            <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100 uppercase tracking-tight">Plan Treningowy</h1>
            <div class="flex flex-col items-center mt-2">
                <span id="user-id-display" class="text-[8px] opacity-50 font-mono"></span>
                <button id="logout-btn" class="text-[10px] font-bold text-red-500 uppercase mt-1">Wyloguj</button>
            </div>
            <button id="theme-toggle" class="p-2 absolute top-5 right-4 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">
                <span id="theme-icon">üåô</span>
            </button>
        </header>

        <main class="p-4 max-w-lg mx-auto">
            <div id="tab-content">
                <!-- Sekcja Startowa (Harmonogram i zasady) -->
                <div class="page-pane" id="harmonogram">
                    <div class="bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm p-4 rounded-xl shadow-sm mb-4">
                        <details>
                            <summary class="font-bold cursor-pointer">Zasady Progresji</summary>
                            <div class="mt-4 space-y-2 text-xs border-t pt-4">
                                <p><strong class="text-blue-600">Technika:</strong> Pe≈Çny zakres ruchu przed ciƒô≈ºarem.</p>
                                <p><strong class="text-blue-600">Przerwy:</strong> 90-120s (G≈Ç√≥wne), 60s (Izolacje).</p>
                            </div>
                        </details>
                    </div>
                    <div class="bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm p-6 rounded-3xl shadow-sm text-center">
                        <h3 class="font-bold mb-4">Harmonogram</h3>
                        <div class="flex items-center justify-center space-x-4 mb-4">
                            <span class="text-sm">3 dni</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="scheduleToggle" class="sr-only">
                                <div class="w-11 h-6 bg-gray-200 rounded-full dark:bg-gray-700"></div>
                                <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition"></div>
                            </label>
                            <span class="text-sm">4 dni</span>
                        </div>
                        <div id="schedule-display" class="text-xs font-medium italic opacity-60">Pon: PUSH | ≈ör: PULL | Pt: LEGS</div>
                    </div>
                </div>

                <!-- Kontenery na treningi PUSH, PULL, LEGS, BRZUCH -->
                <div class="page-pane hidden" id="push">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold uppercase tracking-widest">Push</h3><button data-workout="push" class="save-btn bg-blue-600 text-white px-4 py-1 rounded-lg text-xs font-bold uppercase">Zapisz</button></div>
                    <div id="push-cards" class="space-y-4"></div>
                </div>

                <div class="page-pane hidden" id="pull">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold uppercase tracking-widest">Pull</h3><button data-workout="pull" class="save-btn bg-blue-600 text-white px-4 py-1 rounded-lg text-xs font-bold uppercase">Zapisz</button></div>
                    <div id="pull-cards" class="space-y-4"></div>
                </div>

                <div class="page-pane hidden" id="legs">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold uppercase tracking-widest">Legs</h3><button data-workout="legs" class="save-btn bg-blue-600 text-white px-4 py-1 rounded-lg text-xs font-bold uppercase">Zapisz</button></div>
                    <div id="legs-cards" class="space-y-4"></div>
                </div>

                <div class="page-pane hidden" id="brzuch">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold uppercase tracking-widest">Brzuch</h3><button data-workout="brzuch" class="save-btn bg-blue-600 text-white px-4 py-1 rounded-lg text-xs font-bold uppercase">Zapisz</button></div>
                    <div id="brzuch-cards" class="space-y-4"></div>
                </div>

                <!-- Sekcja Analizy i Wykres√≥w -->
                <div class="page-pane hidden" id="postepy">
                    <h3 class="font-bold mb-4 uppercase text-center tracking-widest">Wykresy</h3>
                    <div id="progress-list" class="space-y-2 mb-4"></div>
                    <div id="chart-container" class="hidden bg-white/60 dark:bg-gray-800/60 backdrop-blur-sm p-4 rounded-3xl shadow-sm border border-white/10">
                        <canvas id="progress-chart"></canvas>
                    </div>
                </div>

                <!-- Sekcja Log√≥w CSV i Importu -->
                <div class="page-pane hidden" id="dziennik">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold uppercase tracking-widest">Logi</h3>
                        <div class="flex gap-2">
                            <button id="import-pasted-csv" class="text-[10px] bg-blue-600 text-white px-3 py-1 rounded-lg font-bold uppercase">Synchronizuj tekst</button>
                            <button id="copy-log" class="text-[10px] bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-lg font-bold uppercase">Kopiuj</button>
                        </div>
                    </div>
                    <textarea id="csv-output" placeholder="Wklej tutaj CSV w formacie: Data,Cwiczenie,Ciezar" class="w-full h-80 p-4 text-[10px] font-mono rounded-3xl bg-gray-100/50 dark:bg-gray-900/50 outline-none resize-none border border-blue-500/20"></textarea>
                    <button id="clear-log" class="w-full mt-4 bg-red-500/10 text-red-500 py-3 rounded-2xl text-xs font-bold uppercase tracking-wider">Wyczy≈õƒá historiƒô w chmurze</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Dolny pasek nawigacyjny -->
    <nav id="app-nav" class="hidden fixed bottom-0 left-0 right-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl border-t border-gray-200 dark:border-gray-800 flex justify-around p-2 z-50">
        <button class="nav-btn p-2 flex flex-col items-center" data-tab="harmonogram"><span>üè†</span><span class="text-[9px] font-bold">START</span></button>
        <button class="nav-btn p-2 flex flex-col items-center" data-tab="push"><span>üí™</span><span class="text-[9px] font-bold">PUSH</span></button>
        <button class="nav-btn p-2 flex flex-col items-center" data-tab="pull"><span>üèãÔ∏è</span><span class="text-[9px] font-bold">PULL</span></button>
        <button class="nav-btn p-2 flex flex-col items-center" data-tab="legs"><span>ü¶µ</span><span class="text-[9px] font-bold">LEGS</span></button>
        <button class="nav-btn p-2 flex flex-col items-center" data-tab="brzuch"><span>üî•</span><span class="text-[9px] font-bold">CORE</span></button>
        <button class="nav-btn p-2 flex flex-col items-center" data-tab="postepy"><span>üìà</span><span class="text-[9px] font-bold">ANALYTICS</span></button>
        <button class="nav-btn p-2 flex flex-col items-center" data-tab="dziennik"><span>üìñ</span><span class="text-[9px] font-bold">LOGS</span></button>
    </nav>

    <div id="toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-[10px] px-6 py-2 rounded-full font-bold opacity-0 transition-opacity z-[110]"></div>

    <script type="module">
        /* Importy SDK Firebase */
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, signInWithCustomToken, signInAnonymously } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        /* Konfiguracja Firebase pobierana ze zmiennych ≈õrodowiskowych */
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        /* Definicja bazy ƒáwicze≈Ñ z opcjami i domy≈õlnymi seriami */
        const workouts = {
            push: [
                { options: [{ name: "Wyciskanie sztangi na ≈Çawce p≈Çaskiej", sets: "4x6-8" }, { name: "Wyciskanie hantli (p≈Çasko)", sets: "4x6-8" }, { name: "Wyciskanie na maszynie siedzƒÖc (klatka)", sets: "4x8-10" }]},
                { options: [{ name: "Wyciskanie hantli (sko≈õna)", sets: "3x8-12" }, { name: "Wyciskanie sztangi na ≈Çawce sko≈õnej", sets: "3x8-12" }, { name: "Wyciskanie na maszynie Smitha (skos dodatni)", sets: "3x8-12" }]},
                { options: [{ name: "Pompki na porƒôczach (z obciƒÖ≈ºeniem)", sets: "3x8-12" }, { name: "Wyciskanie hantli nad g≈Çowƒô (siedzƒÖc)", sets: "3x8-12" }, { name: "Wyciskanie ≈ºo≈Çnierskie (sztanga stojƒÖc)", sets: "3x6-8" }]},
                { options: [{ name: "Wznosy hantli bokiem", sets: "4x10-15" }, { name: "Wznosy linek wyciƒÖgu w bok", sets: "4x10-15" }, { name: "Wznosy bokiem na maszynie", sets: "4x12-15" }]},
                { options: [{ name: "Rozpiƒôtki z hantlami", sets: "3x8-12"}, { name: "Rozpiƒôtki z linkami wyciƒÖgu (brama)", sets: "3x12-15" }, { name: "Rozpiƒôtki na maszynie 'Butterfly'", sets: "3x12-15" }]}, 
                { options: [{ name: "Prostowanie ramion (linka wyciƒÖgu) z dropsetem", sets: "3x10-15" }, { name: "Wyciskanie francuskie sztangƒÖ ≈ÇamanƒÖ", sets: "3x8-12" }, { name: "Wyciskanie francuskie hantlami (m≈Çotkowo)", sets: "3x10-12" }]}
            ],
            pull: [
                { options: [{ name: "PodciƒÖganie na drƒÖ≈ºku (nachwyt)", sets: "4xMAX" }, { name: "≈öciƒÖganie drƒÖ≈ºka wyciƒÖgu", sets: "4x8-12" }, { name: "≈öciƒÖganie na maszynie typu Hammer", sets: "4x8-12" }]},
                { options: [{ name: "Wios≈Çowanie sztangƒÖ (opad tu≈Çowia)", sets: "4x6-8" }, { name: "Wios≈Çowanie hantlem", sets: "4x8-10" }, { name: "Wios≈Çowanie p√≥≈ÇsztangƒÖ (T-Bar)", sets: "4x8-10" }]},
                { options: [{ name: "PrzyciƒÖganie uchwytu V (siedzƒÖc)", sets: "3x10-12" }, { name: "Wios≈Çowanie na maszynie siedzƒÖc", sets: "3x10-12" }, { name: "Wios≈Çowanie hantlami le≈ºƒÖc na ≈Çawce (chest supported)", sets: "3x10-12" }]},
                { options: [{ name: "≈öciƒÖganie drƒÖ≈ºka (proste ramiona)", sets: "3x12-15" }, { name: "Face pulls (linka)", sets: "3x15-20" }, { name: "Odwrotne rozpiƒôtki na maszynie (ty≈Ç barku)", sets: "3x12-15" }]},
                { options: [{ name: "Uginanie ramion ze sztangƒÖ", sets: "4x8-10" }, { name: "Uginanie z hantlami (supinacja)", sets: "4x8-10" }, { name: "Uginanie ramion z linkami wyciƒÖgu dolnego", sets: "4x10-12" }]},
                { options: [{ name: "Uginanie ramion z hantlami na ≈Çawce sko≈õnej", sets: "3x10-15" }, { name: "Uginanie ramion na modlitewniku", sets: "3x10-15" }, { name: "Uginanie m≈Çotkowe z hantlami", sets: "3x10-12" }]}
            ],
            legs: [
                { options: [{ name: "Przysiady ze sztangƒÖ na plecach", sets: "4x6-8" }, { name: "Wypychanie ciƒô≈ºaru na suwnicy", sets: "4x8-10" }, { name: "Przysiady na maszynie Hack", sets: "4x8-10" }]},
                { options: [{ name: "Martwy ciƒÖg na prostych nogach (RDL)", sets: "3x8-12" }, { name: "Uginanie n√≥g na maszynie le≈ºƒÖc", sets: "3x10-12" }, { name: "Uginanie n√≥g na maszynie siedzƒÖc", sets: "3x10-12" }]},
                { options: [{ name: "Przysiady bu≈Çgarskie", sets: "3x8-12 (na nogƒô)" }, { name: "Wykroki z hantlami", sets: "3x10-12 (na nogƒô)" }, { name: "Zakroki ze sztangƒÖ/hantlami", sets: "3x10-12 (na nogƒô)" }]},
                { options: [{ name: "Prostowanie n√≥g na maszynie siedzƒÖc", sets: "3x12-15" }, { name: "Przysiad Goblet", sets: "3x12-15" }, { name: "Przysiad syzyfowy (Sissy Squat)", sets: "3xMAX" }]},
                { options: [{ name: "Hip Thrust ze sztangƒÖ", sets: "4x8-12" }, { name: "'≈ªuraw' (Glute Ham Raise)", sets: "3xMAX" }, { name: "Wyprosty tu≈Çowia na ≈Çawce rzymskiej (pod po≈õladki)", sets: "3x12-15" }]},
                { options: [{ name: "Wspiƒôcia na palce (stojƒÖc)", sets: "4x12-20" }, { name: "Wspiƒôcia na palce na suwnicy", sets: "4x15-25" }, { name: "Wspiƒôcia na palce siedzƒÖc", sets: "4x15-25" }]}
            ],
            brzuch: [
                { options: [{ name: "'Allahy' (linka wyciƒÖgu)", sets: "4x10-15" }, { name: "Spiƒôcia brzucha na maszynie", sets: "4x10-15" }, { name: "Spiƒôcia le≈ºƒÖc z talerzem na klatce", sets: "4x12-15" }]},
                { options: [{ name: "Unoszenie n√≥g w zwisie na drƒÖ≈ºku", sets: "4xMAX" }, { name: "Unoszenie kolan do klatki piersiowej w zwisie", sets: "4xMAX" }, { name: "Scyzoryki (V-ups)", sets: "4x15-20" }]},
                { options: [{ name: "Plank (z obciƒÖ≈ºeniem na plecach)", sets: "4x60-90s" }, { name: "Plank boczny", sets: "3x45-60s (na str.)" }, { name: "Ab Wheel (k√≥≈Çko)", sets: "3x10-15" }]},
                { options: [{ name: "'Wood choppers' (rƒÖbanie drewna)", sets: "3x12-15 (na str.)" }, { name: "'Russian Twist' (skrƒôty tu≈Çowia)", sets: "3x15 (na stronƒô)" }, { name: "Pallof Press (antyrotacja z gumƒÖ/linkƒÖ)", sets: "3x12-15 (na str.)" }]}
            ]
        };

        let trainingLogs = [];
        let chartInstance = null;
        let currentUser = null;

        /* Obs≈Çuga uwierzytelniania: Logowanie, Rejestracja, Google SSO */
        const loginWithEmail = async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            try { await signInWithEmailAndPassword(auth, email, password); } catch (e) { document.getElementById('auth-error').textContent = e.message; }
        };

        const registerWithEmail = async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            try { await createUserWithEmailAndPassword(auth, email, password); } catch (e) { document.getElementById('auth-error').textContent = e.message; }
        };

        const loginWithGoogle = async () => { try { await signInWithPopup(auth, new GoogleAuthProvider()); } catch (e) { document.getElementById('auth-error').textContent = e.message; } };

        document.getElementById('email-login').onclick = loginWithEmail;
        document.getElementById('email-register').onclick = registerWithEmail;
        document.getElementById('google-login').onclick = loginWithGoogle;
        document.getElementById('logout-btn').onclick = () => signOut(auth);

        /* Inicjalizacja autoryzacji przy starcie */
        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else { await signInAnonymously(auth); }
        };
        initAuth();

        /* Reagowanie na zmianƒô stanu zalogowania */
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('auth-overlay').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                document.getElementById('app-nav').classList.remove('hidden');
                document.getElementById('user-id-display').textContent = user.uid;
                syncLogs(user.uid);
            } else {
                document.getElementById('auth-overlay').classList.remove('hidden');
                document.getElementById('app-content').classList.add('hidden');
                document.getElementById('app-nav').classList.add('hidden');
            }
        });

        /* Synchronizacja danych w czasie rzeczywistym z Firestore */
        const syncLogs = (uid) => {
            const userDoc = doc(db, 'artifacts', appId, 'users', uid, 'data', 'logs');
            onSnapshot(userDoc, (snap) => {
                trainingLogs = snap.exists() ? (snap.data().entries || []) : [];
                renderAll();
            }, (err) => console.error("Sync error:", err));
        };

        /* Zapisywanie tablicy wpis√≥w do chmury */
        const saveToCloud = async (entries) => {
            if (!currentUser) return;
            const userDoc = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'data', 'logs');
            await setDoc(userDoc, { entries: entries });
            showToast("Dane zsynchronizowane");
        };

        /* Obliczanie Rekordu ≈ªyciowego i ostatniego wyniku dla ƒáwiczenia */
        const getStats = (name) => {
            const filtered = trainingLogs.filter(l => l.exercise === name);
            if (!filtered.length) return null;
            return { pb: Math.max(...filtered.map(l => l.weight)), last: filtered[filtered.length - 1].weight };
        };

        /* Renderowanie kart ƒáwicze≈Ñ we wszystkich sekcjach treningowych */
        const renderAll = () => {
            Object.keys(workouts).forEach(type => {
                const container = document.getElementById(`${type}-cards`);
                if(!container) return;
                container.innerHTML = workouts[type].map((slot, i) => {
                    const first = slot.options[0];
                    const stats = getStats(first.name);
                    return `
                        <div class="card bg-white/60 dark:bg-gray-800/60 p-5 rounded-3xl border border-white/20">
                            <select class="ex-select w-full bg-transparent font-bold text-sm outline-none mb-2" data-type="${type}" data-idx="${i}">
                                ${slot.options.map(o => `<option value="${o.name}">${o.name}</option>`).join('')}
                            </select>
                            <div class="stats-box text-[10px] font-bold text-blue-500 dark:text-blue-400 mb-4 px-1 flex gap-4">
                                ${stats ? `<span>üèÜ PB: ${stats.pb}kg</span><span>‚èÆ Ost: ${stats.last}kg</span>` : ''}
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="sets-display text-[10px] font-mono opacity-50 uppercase">${slot.options[0].sets}</span>
                                <div class="flex items-center gap-2">
                                    <input type="number" step="0.5" class="weight-input w-16 p-1 bg-slate-100 dark:bg-gray-700 rounded-lg text-center font-bold text-xs" placeholder="0">
                                    <span class="text-[10px] font-bold uppercase opacity-50">kg</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            });
            updateHistoryUI();
        };

        /* Aktualizacja widoku po zmianie wariantu ƒáwiczenia w select */
        document.body.addEventListener('change', (e) => {
            if(e.target.classList.contains('ex-select')) {
                const card = e.target.closest('.card');
                const selected = workouts[e.target.dataset.type][e.target.dataset.idx].options[e.target.selectedIndex];
                card.querySelector('.sets-display').textContent = selected.sets;
                const stats = getStats(selected.name);
                card.querySelector('.stats-box').innerHTML = stats ? `<span>üèÜ PB: ${stats.pb}kg</span><span>‚èÆ Ost: ${stats.last}kg</span>` : '';
            }
        });

        /* Logika zbierania danych z p√≥l tekstowych i wysy≈Çania do chmury przy zapisie */
        document.querySelectorAll('.save-btn').forEach(btn => {
            btn.onclick = () => {
                const type = btn.dataset.workout;
                const cards = document.getElementById(`${type}-cards`).querySelectorAll('.card');
                const now = new Date().toISOString().split('T')[0];
                const newEntries = [];
                cards.forEach(card => {
                    const weight = parseFloat(card.querySelector('.weight-input').value);
                    const name = card.querySelector('.ex-select').value;
                    if(weight > 0) newEntries.push({ date: now, exercise: name, weight });
                });
                if(newEntries.length) saveToCloud([...trainingLogs, ...newEntries]);
            };
        });

        /* Generowanie tekstu CSV i listy przycisk√≥w do wykres√≥w */
        const updateHistoryUI = () => {
            const area = document.getElementById('csv-output');
            area.value = "Data,Cwiczenie,Ciezar\n" + trainingLogs.map(l => `${l.date},${l.exercise},${l.weight}`).join('\n');
            const names = [...new Set(trainingLogs.map(l => l.exercise))].sort();
            document.getElementById('progress-list').innerHTML = names.map(n => `<button class="w-full text-left p-4 bg-white/40 dark:bg-gray-800/40 rounded-2xl text-[10px] font-bold uppercase" onclick="showChart('${n}')">${n}</button>`).join('');
        };

        /* Funkcja importu danych CSV wklejonych rƒôcznie do textarea */
        document.getElementById('import-pasted-csv').onclick = () => {
            const lines = document.getElementById('csv-output').value.split('\n');
            const newEntries = [];
            lines.forEach((line, i) => {
                if (i === 0 || !line.trim()) return;
                const parts = line.split(',');
                if (parts.length >= 3) {
                    newEntries.push({ date: parts[0].trim(), exercise: parts[1].trim(), weight: parseFloat(parts[2]) });
                }
            });
            if (newEntries.length) saveToCloud(newEntries);
        };

        /* Renderowanie wykresu progresji dla wybranego ƒáwiczenia */
        window.showChart = (name) => {
            document.getElementById('chart-container').classList.remove('hidden');
            const ctx = document.getElementById('progress-chart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            const data = trainingLogs.filter(l => l.exercise === name).sort((a,b) => new Date(a.date) - new Date(b.date));
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels: data.map(l => l.date), datasets: [{ data: data.map(l => l.weight), borderColor: '#2563eb', tension: 0.4 }] },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: false } } }
            });
        };

        /* Logika nawigacji miƒôdzy zak≈Çadkami oraz obs≈Çuga gest√≥w swipe */
        const tabOrder = ['harmonogram', 'push', 'pull', 'legs', 'brzuch', 'postepy', 'dziennik'];
        let tStart = 0;
        const navigate = (id, dir = null) => {
            const curr = document.querySelector('.page-pane:not(.hidden)');
            const dest = document.getElementById(id);
            if(curr === dest) return;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('active', b.dataset.tab === id));
            if(dir) {
                curr.classList.add(dir === 'L' ? 'animate-slide-out-to-left' : 'animate-slide-out-to-right');
                dest.classList.add(dir === 'L' ? 'animate-slide-in-from-right' : 'animate-slide-in-from-left');
            }
            dest.classList.remove('hidden');
            setTimeout(() => { curr.classList.add('hidden'); curr.className = 'page-pane hidden'; dest.className = 'page-pane'; }, 300);
        };

        document.querySelectorAll('.nav-btn').forEach(b => b.onclick = () => navigate(b.dataset.tab));
        window.addEventListener('touchstart', e => tStart = e.touches[0].clientX);
        window.addEventListener('touchend', e => {
            const dx = e.changedTouches[0].clientX - tStart;
            if(Math.abs(dx) > 100) {
                const idx = tabOrder.indexOf(document.querySelector('.page-pane:not(.hidden)').id);
                if(dx < 0 && idx < tabOrder.length - 1) navigate(tabOrder[idx+1], 'L');
                if(dx > 0 && idx > 0) navigate(tabOrder[idx-1], 'R');
            }
        });

        /* Narzƒôdzia pomocnicze: Toast, Prze≈ÇƒÖcznik Motywu, Efekt Scroll */
        const showToast = (m) => { const t = document.getElementById('toast'); t.textContent = m; t.style.opacity = '1'; setTimeout(() => t.style.opacity = '0', 2000); };
        document.getElementById('theme-toggle').onclick = () => {
            const isDark = document.documentElement.classList.toggle('dark');
            document.getElementById('theme-icon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        };
        window.onscroll = () => document.body.style.setProperty('--scroll-y', `${window.scrollY / -15}px`);
        
        /* Usuwanie danych z Firestore */
        document.getElementById('clear-log').onclick = async () => { if(confirm('Wyczy≈õciƒá ca≈ÇƒÖ historiƒô w chmurze?') && currentUser) await setDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'data', 'logs'), { entries: [] }); };
        document.getElementById('copy-log').onclick = () => { document.getElementById('csv-output').select(); document.execCommand('copy'); showToast('Skopiowano!'); };

        /* Prze≈ÇƒÖcznik harmonogramu 3/4 dni */
        const scheduleToggle = document.getElementById('scheduleToggle');
        scheduleToggle.onchange = () => {
            document.getElementById('schedule-display').textContent = scheduleToggle.checked ? "Pon: PUSH | Wt: PULL | Czw: LEGS | Pt: PUSH" : "Pon: PUSH | ≈ör: PULL | Pt: LEGS";
            document.querySelector('.dot').style.transform = scheduleToggle.checked ? 'translateX(1.25rem)' : 'translateX(0)';
        };

        renderAll();
    </script>
</body>
</html>