<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktywny Plan Treningowy z Dziennikiem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: "Slate & Amber" -->
    <!-- Application Structure Plan: Extended the tab-based application to include a new "Log" (Dziennik) tab. This structure maintains the clear separation of concerns. Workout tabs are now interactive forms for data input (exercise selection, weight). The Log tab serves as a central point for data output and export. This flow (Input -> Save -> Review/Export) is intuitive for tracking progress. Direct Google Sheets integration is not feasible/secure in a client-side app, so a CSV-export-to-clipboard function provides the best workaround, empowering the user to easily transfer data. -->
    <!-- Visualization & Content Choices: Report Info: Exercise selection -> Goal: Organize & Input -> Presentation: Dropdown menu (<select>) for each exercise. Interaction: User selects the main or alternative exercise. Justification: Cleaner and more direct than the previous info button, integrates seamlessly into a data-entry form. Report Info: Weight tracking -> Goal: Input -> Presentation: Number input field (<input type="number">). Interaction: User enters the weight used. Justification: Standard and effective for numeric data entry. Report Info: Saving progress -> Goal: Export Data -> Presentation: A "Log" tab with a textarea and "Copy" button. Interaction: User saves a workout, which generates a CSV string in the textarea. They can then copy this string. Justification: This is a secure and robust client-side solution for data export, allowing easy pasting into Google Sheets or other spreadsheet software. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-btn.active {
            border-color: #f59e0b;
            background-color: #fffbeb;
            color: #b45309;
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateY(10px); }
            10%, 90% { opacity: 1; transform: translateY(0); }
        }
        .toast-animation {
            animation: fadeInOut 2s ease-in-out;
        }
        .chart-container {
            position: relative;
            height: 50vh;
            max-height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-6xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Interaktywny Plan Treningowy</h1>
            <p class="mt-2 text-slate-600">Tw√≥j plan na powr√≥t do formy. Powodzenia!</p>
        </header>

        <main>
            <section id="zasady" class="mb-10">
                <h2 class="text-2xl font-semibold text-center mb-6">Najwa≈ºniejsze Zasady</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="font-semibold text-lg mb-2 text-amber-600">1. Technika ponad ciƒô≈ºarem</h3>
                        <p class="text-slate-600 text-sm">To Twoja zasada numer jeden. Zawsze. Lepsza jest perfekcyjna forma z mniejszym ciƒô≈ºarem ni≈º ryzyko kontuzji. Skup siƒô na pe≈Çnym zakresie ruchu.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="font-semibold text-lg mb-2 text-amber-600">2. Rozgrzewka i Cool Down</h3>
                        <p class="text-slate-600 text-sm">Zawsze 10-15 min rozgrzewki (cardio + serie wstƒôpne) przed treningiem i 5-10 min rozciƒÖgania statycznego po jego zako≈Ñczeniu.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="font-semibold text-lg mb-2 text-amber-600">3. Stopniowa Progresja</h3>
                        <p class="text-slate-600 text-sm">W pierwszym tygodniu skup siƒô na technice. W kolejnych staraj siƒô dok≈Çadaƒá ma≈Çy ciƒô≈ºar lub zwiƒôkszaƒá liczbƒô powt√≥rze≈Ñ, gdy czujesz siƒô pewnie.</p>
                    </div>
                </div>
            </section>
            
            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md border border-slate-200">
                <div class="border-b border-slate-200 mb-6">
                    <nav class="-mb-px flex flex-wrap gap-2 sm:gap-4" aria-label="Tabs">
                        <button class="tab-btn" data-tab="harmonogram">üóìÔ∏è Harmonogram</button>
                        <button class="tab-btn" data-tab="push">üí™ PUSH</button>
                        <button class="tab-btn" data-tab="pull">üèãÔ∏è PULL</button>
                        <button class="tab-btn" data-tab="legs">ü¶µ LEGS</button>
                        <button class="tab-btn" data-tab="brzuch">üî• BRZUCH</button>
                        <button class="tab-btn" data-tab="postepy">üìä Postƒôpy</button>
                        <button class="tab-btn" data-tab="dziennik">üìã Dziennik</button>
                    </nav>
                </div>

                <div id="tab-content">
                    <div class="tab-pane" id="harmonogram">
                        <h3 class="text-xl font-semibold mb-4">Wariantowy Harmonogram Trening√≥w</h3>
                        <p class="mb-6 text-slate-600">System PUSH / PULL / LEGS daje du≈ºƒÖ elastyczno≈õƒá. Wybierz opcjƒô, kt√≥ra najlepiej pasuje do Twojego tygodnia. Pamiƒôtaj, ≈ºe regularno≈õƒá jest kluczowa.</p>
                        <div class="flex items-center justify-center space-x-4 mb-6">
                            <span class="font-medium">3 dni w tygodniu</span>
                            <label for="scheduleToggle" class="flex items-center cursor-pointer">
                                <div class="relative">
                                    <input type="checkbox" id="scheduleToggle" class="sr-only">
                                    <div class="block bg-slate-200 w-14 h-8 rounded-full"></div>
                                    <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
                                </div>
                            </label>
                            <span class="font-medium">4 dni w tygodniu</span>
                        </div>
                        <div id="schedule-display" class="bg-slate-100 p-4 rounded-lg text-center">
                            <h4 class="font-semibold mb-2">Przyk≈Çadowy plan (3 dni):</h4>
                            <p>Poniedzia≈Çek - PUSH, ≈öroda - PULL, PiƒÖtek - LEGS</p>
                        </div>
                    </div>
                    
                    <div class="tab-pane" id="push">
                        <h3 class="text-xl font-semibold mb-1">Dzie≈Ñ Treningowy: PUSH</h3>
                        <p class="text-slate-500 mb-4">(Klatka, Barki, Tricepsy)</p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                                    <tr>
                                        <th scope="col" class="px-4 py-3 w-2/5">ƒÜwiczenie</th>
                                        <th scope="col" class="px-4 py-3 text-center">Serie x Powt.</th>
                                        <th scope="col" class="px-4 py-3 text-center">Ciƒô≈ºar (kg)</th>
                                    </tr>
                                </thead>
                                <tbody id="push-tbody"></tbody>
                            </table>
                        </div>
                        <div class="mt-6 text-right">
                            <button id="save-push" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded transition-colors">Zapisz Trening</button>
                        </div>
                    </div>

                    <div class="tab-pane" id="pull">
                        <h3 class="text-xl font-semibold mb-1">Dzie≈Ñ Treningowy: PULL</h3>
                        <p class="text-slate-500 mb-4">(Plecy, Bicepsy)</p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                                    <tr><th scope="col" class="px-4 py-3 w-2/5">ƒÜwiczenie</th><th scope="col" class="px-4 py-3 text-center">Serie x Powt.</th><th scope="col" class="px-4 py-3 text-center">Ciƒô≈ºar (kg)</th></tr>
                                </thead>
                                <tbody id="pull-tbody"></tbody>
                            </table>
                        </div>
                         <div class="mt-6 text-right">
                            <button id="save-pull" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded transition-colors">Zapisz Trening</button>
                        </div>
                    </div>

                    <div class="tab-pane" id="legs">
                        <h3 class="text-xl font-semibold mb-1">Dzie≈Ñ Treningowy: LEGS</h3>
                        <p class="text-slate-500 mb-4">(Nogi, Po≈õladki)</p>
                         <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                                    <tr><th scope="col" class="px-4 py-3 w-2/5">ƒÜwiczenie</th><th scope="col" class="px-4 py-3 text-center">Serie x Powt.</th><th scope="col" class="px-4 py-3 text-center">Ciƒô≈ºar (kg)</th></tr>
                                </thead>
                                <tbody id="legs-tbody"></tbody>
                            </table>
                        </div>
                         <div class="mt-6 text-right">
                            <button id="save-legs" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded transition-colors">Zapisz Trening</button>
                        </div>
                    </div>

                    <div class="tab-pane" id="brzuch">
                         <h3 class="text-xl font-semibold mb-1">Trening Miƒô≈õni Brzucha</h3>
                         <p class="text-slate-500 mb-4">Dodaj 2 wybrane ƒáwiczenia na koniec ka≈ºdego treningu.</p>
                         <div class="mb-6 bg-amber-50 border-l-4 border-amber-400 p-4">
                            <h4 class="font-semibold">Rekomendacja: Wysoka Czƒôstotliwo≈õƒá</h4>
                            <p class="text-slate-700 text-sm mt-1">Lepszym rozwiƒÖzaniem bƒôdzie dodanie 2 ƒáwicze≈Ñ na brzuch na koniec ka≈ºdej sesji (Push, Pull i Legs). Zapewni to sta≈ÇƒÖ stymulacjƒô i wzmocni core bez nadmiernego zmƒôczenia.</p>
                         </div>
                         <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                                    <tr><th scope="col" class="px-4 py-3 w-2/5">ƒÜwiczenie</th><th scope="col" class="px-4 py-3 text-center">Serie x Powt.</th><th scope="col" class="px-4 py-3 text-center">Ciƒô≈ºar (kg)</th></tr>
                                </thead>
                                <tbody id="brzuch-tbody"></tbody>
                            </table>
                        </div>
                         <div class="mt-6 text-right">
                            <button id="save-brzuch" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded transition-colors">Zapisz Trening Brzucha</button>
                        </div>
                    </div>
                    
                    <div class="tab-pane" id="postepy">
                        <h3 class="text-xl font-semibold mb-4">Wizualizacja Postƒôp√≥w</h3>
                        <p class="text-slate-600 mb-4">Wybierz ƒáwiczenie z listy, aby zobaczyƒá wykres progresji ciƒô≈ºaru w czasie. Lista zawiera tylko te ƒáwiczenia, dla kt√≥rych zapisa≈Çe≈õ/a≈õ ju≈º wyniki w dzienniku.</p>
                        <div id="no-data-message" class="hidden text-center bg-slate-100 p-6 rounded-lg">
                            <p class="font-semibold">Brak danych do wy≈õwietlenia.</p>
                            <p class="text-sm text-slate-600 mt-1">Zapisz najpierw kilka trening√≥w w zak≈Çadce "Dziennik", aby zobaczyƒá swoje postƒôpy.</p>
                        </div>
                        <div class="mb-4">
                            <select id="exercise-select" class="w-full max-w-sm mx-auto p-2 border border-slate-300 rounded-md hidden"></select>
                        </div>
                        <div id="progress-chart-container" class="chart-container hidden">
                            <canvas id="progress-chart"></canvas>
                        </div>
                    </div>

                    <div class="tab-pane" id="dziennik">
                        <h3 class="text-xl font-semibold mb-4">Dziennik Treningowy (CSV)</h3>
                        <p class="text-slate-600 mb-2">Twoje zapisane treningi pojawiƒÖ siƒô tutaj w formacie CSV. Mo≈ºesz je skopiowaƒá i wkleiƒá bezpo≈õrednio do Arkuszy Google lub innego arkusza kalkulacyjnego.</p>
                        <div class="bg-slate-100 p-4 rounded-lg mb-4">
                            <h4 class="font-semibold text-slate-800">Jak przenie≈õƒá dane do Arkuszy Google?</h4>
                            <ol class="list-decimal list-inside text-sm text-slate-700 mt-2 space-y-1">
                                <li>Naci≈õnij przycisk "Kopiuj Dziennik".</li>
                                <li>Otw√≥rz pusty Arkusz Google.</li>
                                <li>Zaznacz kom√≥rkƒô A1.</li>
                                <li>Wklej skopiowane dane (Ctrl+V lub Cmd+V).</li>
                                <li>Google automatycznie rozdzieli dane na kolumny.</li>
                            </ol>
                        </div>
                        <textarea id="csv-output" class="w-full h-64 p-2 border border-slate-300 rounded-md bg-slate-50 font-mono text-sm" readonly placeholder="Tutaj pojawiƒÖ siƒô Twoje zapisane treningi..."></textarea>
                        <div class="mt-4 flex justify-end items-center relative">
                             <span id="toast-message" class="absolute right-0 -top-8 text-white text-sm font-bold py-1 px-3 rounded-md opacity-0"></span>
                            <button id="clear-log" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors mr-2">Wyczy≈õƒá Dziennik</button>
                            <button id="copy-log" class="bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded transition-colors">Kopiuj Dziennik</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const workouts = {
                push: [
                    { options: [
                        { name: "Wyciskanie sztangi na ≈Çawce p≈Çaskiej", sets: "4x8-10" },
                        { name: "Wyciskanie hantli (p≈Çasko)", sets: "4x8-10" },
                        { name: "Pompki na porƒôczach", sets: "4xMAX" }
                    ]},
                    { options: [
                        { name: "Wyciskanie hantli nad g≈Çowƒô (siedzƒÖc)", sets: "3x8-12" },
                        { name: "Wyciskanie ≈ºo≈Çnierskie (stojƒÖc)", sets: "3x8-10" },
                        { name: "Wyciskanie na maszynie", sets: "3x10-12" }
                    ]},
                    { options: [
                        { name: "Wyciskanie sztangi na ≈Çawce sko≈õnej", sets: "3x10-12" },
                        { name: "Wyciskanie hantli (sko≈õna)", sets: "3x10-12" }
                    ]},
                    { options: [
                        { name: "Wznosy hantli bokiem", sets: "3x12-15" },
                        { name: "Face pulls (linka)", sets: "3x12-15" }
                    ]},
                    { options: [
                        { name: "Rozpiƒôtki na maszynie 'Butterfly'", sets: "3x12-15" },
                        { name: "Rozpiƒôtki z hantlami", sets: "3x12-15" }
                    ]},
                    { options: [
                        { name: "Prostowanie ramion (linka wyciƒÖgu)", sets: "3x10-15" },
                        { name: "Wyciskanie francuskie", sets: "3x10-12" }
                    ]}
                ],
                pull: [
                    { options: [
                        { name: "PodciƒÖganie na drƒÖ≈ºku (nachwyt)", sets: "4xMAX" },
                        { name: "≈öciƒÖganie drƒÖ≈ºka wyciƒÖgu", sets: "4x8-12" }
                    ]},
                    { options: [
                        { name: "Wios≈Çowanie sztangƒÖ (opad tu≈Çowia)", sets: "4x8-10" },
                        { name: "Wios≈Çowanie hantlem", sets: "4x8-10" },
                        { name: "Wios≈Çowanie na maszynie", sets: "4x10-12" }
                    ]},
                    { options: [
                        { name: "PrzyciƒÖganie uchwytu V (siedzƒÖc)", sets: "3x10-12" },
                        { name: "Wios≈Çowanie 'p√≥≈ÇsztangƒÖ'", sets: "3x8-10" }
                    ]},
                    { options: [
                        { name: "≈öciƒÖganie drƒÖ≈ºka (proste ramiona)", sets: "3x12-15" },
                        { name: "Przenoszenie hantla ('pullover')", sets: "3x12-15" }
                    ]},
                    { options: [
                        { name: "Uginanie ramion ze sztangƒÖ", sets: "3x10-12" },
                        { name: "Uginanie z hantlami (supinacja)", sets: "3x10-12" }
                    ]},
                    { options: [
                        { name: "Uginanie ramion na modlitewniku", sets: "3x10-15" },
                        { name: "Uginanie w oparciu o ≈Çawkƒô", sets: "3x10-12" }
                    ]}
                ],
                legs: [
                    { options: [
                        { name: "Przysiady ze sztangƒÖ", sets: "4x8-10" },
                        { name: "Wypychanie na suwnicy", sets: "4x10-12" },
                        { name: "Przysiady bu≈Çgarskie", sets: "4x8-10 (na nogƒô)" }
                    ]},
                    { options: [
                        { name: "Martwy ciƒÖg na prostych nogach (RDL)", sets: "3x10-12" },
                        { name: "'Dzie≈Ñ dobry' ze sztangƒÖ", sets: "3x10-12" },
                        { name: "Uginanie n√≥g (le≈ºƒÖc)", sets: "3x12-15" }
                    ]},
                    { options: [
                        { name: "Wykroki z hantlami", sets: "3x10-12 (na nogƒô)" },
                        { name: "Wchodzenie na podwy≈ºszenie", sets: "3x10-12 (na nogƒô)" }
                    ]},
                    { options: [
                        { name: "Prostowanie n√≥g na maszynie", sets: "3x12-15" },
                        { name: "Przysiad 'sissy squat'", sets: "3xMAX" }
                    ]},
                    { options: [
                        { name: "Uginanie n√≥g na maszynie (siedzƒÖc)", sets: "3x12-15" },
                        { name: "'≈ªuraw' (Glute Ham Raise)", sets: "3xMAX" }
                    ]},
                    { options: [
                        { name: "Wspiƒôcia na palce (stojƒÖc)", sets: "4x15-20" },
                        { name: "Wspiƒôcia na suwnicy", sets: "4x15-20" },
                        { name: "Wspiƒôcia z hantlem", sets: "4x15-20" }
                    ]}
                ],
                brzuch: [
                    { options: [
                        { name: "'Allahy' (linka wyciƒÖgu)", sets: "3x15-20" },
                        { name: "Spiƒôcia na maszynie", sets: "3x15-20" }
                    ]},
                    { options: [
                        { name: "Unoszenie n√≥g w zwisie", sets: "3xMAX" },
                        { name: "Unoszenie kolan w zwisie", sets: "3xMAX" }
                    ]},
                    { options: [
                        { name: "Plank (deska)", sets: "3x60s" },
                        { name: "Plank boczny", sets: "3x30-45s (na str.)" }
                    ]},
                    { options: [
                        { name: "'Russian Twist' (z obciƒÖ≈ºeniem)", sets: "3x15 (na str.)" },
                        { name: "'Wood choppers' (wyciƒÖg)", sets: "3x12-15 (na str.)" }
                    ]}
                ]
            };

            const LOG_STORAGE_KEY = 'interactiveTrainingLog';
            let progressChart = null; 

            function showToast(message, type = 'success') {
                const toast = document.getElementById('toast-message');
                const colors = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    info: 'bg-blue-500'
                };
                
                toast.className = 'absolute right-0 -top-8 text-white text-sm font-bold py-1 px-3 rounded-md opacity-0 transition-all duration-300';
                
                toast.textContent = message;
                toast.classList.add(colors[type]);
                toast.classList.remove('opacity-0');
                toast.classList.add('toast-animation');
                
                setTimeout(() => {
                    toast.classList.add('opacity-0');
                    toast.classList.remove('toast-animation');
                }, 2200);
            }

            function saveLogToStorage() {
                const csvOutput = document.getElementById('csv-output');
                localStorage.setItem(LOG_STORAGE_KEY, csvOutput.value);
            }

            function loadLogFromStorage() {
                const csvOutput = document.getElementById('csv-output');
                const savedLog = localStorage.getItem(LOG_STORAGE_KEY);
                if (savedLog) {
                    csvOutput.value = savedLog;
                }
            }

            function populateTables() {
                for (const workoutType in workouts) {
                    const tbody = document.getElementById(`${workoutType}-tbody`);
                    if (tbody) {
                        tbody.innerHTML = ''; 
                        workouts[workoutType].forEach((exerciseSlot, index) => {
                            const row = document.createElement('tr');
                            row.className = 'bg-white border-b exercise-row';
                            row.dataset.index = index;
                            
                            const optionsHtml = exerciseSlot.options
                                .map(opt => `<option value="${opt.name}">${opt.name}</option>`).join('');

                            const initialSets = exerciseSlot.options[0].sets;

                            row.innerHTML = `
                                <td class="px-4 py-2">
                                    <select class="w-full p-2 border border-slate-200 rounded-md text-sm exercise-select">
                                        ${optionsHtml}
                                    </select>
                                </td>
                                <td class="px-4 py-2 text-center font-mono sets-cell">${initialSets}</td>
                                <td class="px-4 py-2 text-center">
                                    <input type="number" step="0.5" min="0" class="w-20 p-2 border border-slate-200 rounded-md text-center weight-input" placeholder="0">
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                }
            }

            function saveWorkout(workoutType) {
                const tbody = document.getElementById(`${workoutType}-tbody`);
                const rows = tbody.querySelectorAll('.exercise-row');
                const csvOutput = document.getElementById('csv-output');
                const today = new Date().toISOString().slice(0, 10);
                let workoutData = "";

                rows.forEach(row => {
                    const exerciseSelect = row.querySelector('.exercise-select');
                    const weightInput = row.querySelector('.weight-input');
                    const weight = parseFloat(weightInput.value);

                    if (weight > 0) {
                        const exerciseName = exerciseSelect.value;
                        const setsInfo = row.querySelector('.sets-cell').textContent;
                        workoutData += `${today},${workoutType.toUpperCase()},"${exerciseName}",${setsInfo},${weight}\n`;
                    }
                });

                if(workoutData) {
                    if (csvOutput.value === "") {
                        csvOutput.value = "Data,Trening,ƒÜwiczenie,Serie x Powt.,Ciƒô≈ºar (kg)\n";
                    }
                    csvOutput.value += workoutData;
                    saveLogToStorage();
                    showToast(`Trening ${workoutType.toUpperCase()} zapisany!`, 'info');
                } else {
                    showToast('Wprowad≈∫ ciƒô≈ºar, aby zapisaƒá.', 'error');
                }
            }

            function parseCsvData() {
                const log = localStorage.getItem(LOG_STORAGE_KEY);
                if (!log || log.split('\n').length < 2) return [];
                const rows = log.trim().split('\n');
                rows.shift(); 
                return rows.map(row => {
                    const values = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                    return {
                        date: values[0],
                        workout: values[1],
                        exercise: values[2] ? values[2].replace(/"/g, '') : '',
                        sets: values[3],
                        weight: parseFloat(values[4])
                    };
                });
            }

            function updateProgressTab() {
                const data = parseCsvData();
                const exerciseSelect = document.getElementById('exercise-select');
                const chartContainer = document.getElementById('progress-chart-container');
                const noDataMessage = document.getElementById('no-data-message');
                
                if (data.length === 0) {
                    noDataMessage.classList.remove('hidden');
                    chartContainer.classList.add('hidden');
                    exerciseSelect.classList.add('hidden');
                    return;
                }

                noDataMessage.classList.add('hidden');
                exerciseSelect.classList.remove('hidden');
                
                const uniqueExercises = [...new Set(data.map(item => item.exercise))].sort();
                
                exerciseSelect.innerHTML = '<option value="">-- Wybierz ƒáwiczenie --</option>';
                uniqueExercises.forEach(ex => {
                    if(ex) {
                        const option = document.createElement('option');
                        option.value = ex;
                        option.textContent = ex;
                        exerciseSelect.appendChild(option);
                    }
                });
            }
            
            function renderProgressChart(selectedExercise) {
                const chartContainer = document.getElementById('progress-chart-container');
                if (!selectedExercise) {
                    chartContainer.classList.add('hidden');
                    return;
                }
                
                chartContainer.classList.remove('hidden');
                const data = parseCsvData();
                const chartData = data
                    .filter(item => item.exercise === selectedExercise)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));

                const labels = chartData.map(d => d.date);
                const weights = chartData.map(d => d.weight);

                const ctx = document.getElementById('progress-chart').getContext('2d');
                
                if (progressChart) {
                    progressChart.destroy();
                }

                progressChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `Progresja ciƒô≈ºaru (kg)`,
                            data: weights,
                            borderColor: '#f59e0b',
                            backgroundColor: '#fef3c7',
                            fill: true,
                            tension: 0.1,
                            pointBackgroundColor: '#b45309',
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: selectedExercise,
                                font: {
                                    size: 16
                                }
                            },
                             legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: { display: true, text: 'Ciƒô≈ºar (kg)' }
                            },
                            x: {
                                title: { display: true, text: 'Data' }
                            }
                        }
                    }
                });
            }


            document.getElementById('save-push').addEventListener('click', () => saveWorkout('push'));
            document.getElementById('save-pull').addEventListener('click', () => saveWorkout('pull'));
            document.getElementById('save-legs').addEventListener('click', () => saveWorkout('legs'));
            document.getElementById('save-brzuch').addEventListener('click', () => saveWorkout('brzuch'));

            document.getElementById('copy-log').addEventListener('click', () => {
                const csvOutput = document.getElementById('csv-output');
                 if(!csvOutput.value) return;
                csvOutput.select();
                document.execCommand('copy');
                showToast('Skopiowano do schowka!', 'success');
            });

            document.getElementById('clear-log').addEventListener('click', () => {
                const csvOutput = document.getElementById('csv-output');
                if (!csvOutput.value) return;

                if (confirm("Czy na pewno chcesz trwale usunƒÖƒá ca≈Çy dziennik? Tej operacji nie mo≈ºna cofnƒÖƒá.")) {
                    csvOutput.value = '';
                    localStorage.removeItem(LOG_STORAGE_KEY);
                    showToast('Dziennik wyczyszczony!', 'error');
                    updateProgressTab(); 
                    if (progressChart) progressChart.destroy();
                    document.getElementById('progress-chart-container').classList.add('hidden');
                }
            });

            const tabs = document.querySelectorAll('.tab-btn');
            const panes = document.querySelectorAll('.tab-pane');
            const scheduleToggle = document.getElementById('scheduleToggle');
            const scheduleDisplay = document.getElementById('schedule-display');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.getAttribute('data-tab');
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    panes.forEach(pane => {
                        pane.classList.add('hidden');
                    });
                    document.getElementById(target).classList.remove('hidden');

                    if (target === 'postepy') {
                        updateProgressTab();
                    }
                });
            });

            document.getElementById('exercise-select').addEventListener('change', (e) => {
                renderProgressChart(e.target.value);
            });


            scheduleToggle.addEventListener('change', () => {
                const toggleDot = scheduleToggle.parentElement.querySelector('.dot');
                const toggleBlock = scheduleToggle.parentElement.querySelector('.block');
                if (scheduleToggle.checked) {
                    scheduleDisplay.innerHTML = `<h4 class="font-semibold mb-2">Przyk≈Çadowy plan (4 dni):</h4><p>Poniedzia≈Çek - PUSH, Wtorek - PULL, Czwartek - LEGS, PiƒÖtek - PUSH.<br><small>(W kolejnym tygodniu zaczniesz od PULL)</small></p>`;
                    toggleDot.style.transform = 'translateX(100%)';
                    toggleBlock.classList.add('bg-amber-400');
                    toggleBlock.classList.remove('bg-slate-200');
                } else {
                    scheduleDisplay.innerHTML = `<h4 class="font-semibold mb-2">Przyk≈Çadowy plan (3 dni):</h4><p>Poniedzia≈Çek - PUSH, ≈öroda - PULL, PiƒÖtek - LEGS</p>`;
                    toggleDot.style.transform = 'translateX(0)';
                    toggleBlock.classList.remove('bg-amber-400');
                    toggleBlock.classList.add('bg-slate-200');
                }
            });

            populateTables();
            loadLogFromStorage();

            document.querySelectorAll('#push-tbody, #pull-tbody, #legs-tbody, #brzuch-tbody').forEach(tbody => {
                tbody.addEventListener('change', function(e) {
                    if (e.target.classList.contains('exercise-select')) {
                        const selectEl = e.target;
                        const selectedIndex = selectEl.selectedIndex;
                        const row = selectEl.closest('tr');
                        const rowIndex = parseInt(row.dataset.index, 10);
                        const workoutType = this.id.replace('-tbody', '');

                        const newSets = workouts[workoutType][rowIndex].options[selectedIndex].sets;

                        const setsCell = row.querySelector('.sets-cell');
                        setsCell.textContent = newSets;
                    }
                });
            });

            document.querySelector('.tab-btn[data-tab="harmonogram"]').click();
        
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => {
                btn.classList.add('py-2', 'px-3', 'sm:px-4', 'font-semibold', 'text-slate-600', 'border-b-2', 'border-transparent', 'hover:border-slate-300', 'hover:text-slate-800', 'transition-colors', 'duration-200', 'whitespace-nowrap', 'text-sm', 'sm:text-base', 'rounded-t-md');
            });
        });
    </script>

</body>
</html>

